<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guest Accommodations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
    <!-- Firebase SDKs -->
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <header class="bg-green-600 text-white p-4 text-center shadow-lg">
        <h1 class="text-2xl font-bold">House Guests</h1>
    </header>

    <nav class="flex flex-wrap justify-center bg-gray-700 p-2 gap-2">
        <button onclick="window.showSection('dashboard')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Dashboard</button>
        <button onclick="window.showSection('houses')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Houses</button>
        <button onclick="window.showSection('rooms')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Rooms</button>
        <button onclick="window.showSection('guests')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Guests</button>
        <button onclick="window.showSection('assignments')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Assign Guests</button>
        <button onclick="window.showSection('tasks')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Required Tasks</button>
        <button onclick="window.showSection('reports')" class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">Reports</button>
    </nav>

    <main class="p-4 md:p-8 max-w-7xl mx-auto">
        <!-- Dashboard Section -->
        <section id="dashboard" class="bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Dashboard</h2>
            <div id="dashboard-tiles" class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"></div>
            <div id="dashboard-guests-list" class="mt-8"></div>
            <div id="user-info" class="mt-6 text-sm text-gray-500"></div>
        </section>

        <!-- Houses Section -->
        <section id="houses" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Manage Houses</h2>
            <form id="house-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <input type="text" id="house-name" placeholder="House Name" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <button type="submit" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200">Add House</button>
            </form>
            <!-- Edit form for houses (initially hidden) -->
            <form id="house-edit-form" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-100 rounded-lg">
                <input type="hidden" id="house-edit-id">
                <input type="text" id="house-edit-name" placeholder="House Name" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <div class="flex gap-2 col-span-1 md:col-span-2">
                    <button type="submit" class="flex-grow bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors duration-200">Update House</button>
                    <button type="button" onclick="window.hideEditForm('house')" class="bg-gray-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors duration-200">Cancel</button>
                </div>
            </form>
            <ul id="house-list" class="space-y-3"></ul>
        </section>

        <!-- Rooms Section -->
        <section id="rooms" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Manage Rooms</h2>
            <form id="room-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <select id="room-house" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select a House</option>
                </select>
                <input type="text" id="room-name" placeholder="Room Name (e.g., Master Bedroom)" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <input type="number" id="room-capacity" placeholder="Capacity (e.g., 2)" required min="1" class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <select id="room-bed-type" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select Bed Type</option>
                    <option value="king">King</option>
                    <option value="queen">Queen</option>
                    <option value="full">Full</option>
                    <option value="twin">Twin</option>
                    <option value="none">None</option>
                </select>
                <div class="col-span-1 md:col-span-2 bg-gray-100 rounded-lg p-4 -mt-4 mb-4">
                    <p class="font-medium mb-2">Prep Needed:</p>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="room-prep-item" placeholder="e.g., Buy new sheets" class="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <button type="button" onclick="window.addPrepItem()" class="bg-gray-400 text-white font-bold px-4 rounded-lg hover:bg-gray-500 transition-colors duration-200">Add</button>
                    </div>
                    <ul id="prep-list" class="list-disc list-inside space-y-1"></ul>
                </div>
                <button type="submit" class="col-span-1 md:col-span-2 bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200">Add Room</button>
            </form>
            <!-- Edit form for rooms (initially hidden) -->
            <form id="room-edit-form" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-100 rounded-lg">
                <input type="hidden" id="room-edit-id">
                <input type="hidden" id="room-edit-houseId">
                <input type="text" id="room-edit-houseName" disabled class="p-2 border border-gray-300 rounded-md">
                <input type="text" id="room-edit-name" placeholder="Room Name" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <input type="number" id="room-edit-capacity" placeholder="Capacity" required min="1" class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <select id="room-edit-bed-type" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select Bed Type</option>
                    <option value="king">King</option>
                    <option value="queen">Queen</option>
                    <option value="full">Full</option>
                    <option value="twin">Twin</option>
                    <option value="none">None</option>
                </select>
                <div class="col-span-1 md:col-span-2 bg-gray-200 rounded-lg p-4 -mt-4 mb-4">
                    <p class="font-medium mb-2">Prep Needed:</p>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="room-edit-prep-item" placeholder="e.g., Buy new sheets" class="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <button type="button" onclick="window.addEditPrepItem()" class="bg-gray-400 text-white font-bold px-4 rounded-lg hover:bg-gray-500 transition-colors duration-200">Add</button>
                    </div>
                    <ul id="edit-prep-list" class="list-disc list-inside space-y-1"></ul>
                </div>
                <div class="flex gap-2 col-span-1 md:col-span-2">
                    <button type="submit" class="flex-grow bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors duration-200">Update Room</button>
                    <button type="button" onclick="window.hideEditForm('room')" class="bg-gray-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors duration-200">Cancel</button>
                </div>
            </form>
            <div class="flex items-center gap-4 mb-4">
                <span class="font-medium">Sort by:</span>
                <button onclick="window.sortRooms('houseName')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-3 rounded-md transition-colors duration-200">House</button>
                <button onclick="window.sortRooms('name')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-3 rounded-md transition-colors duration-200">Room</button>
            </div>
            <ul id="room-list" class="space-y-3"></ul>
        </section>

        <!-- Guests Section -->
        <section id="guests" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Manage Guests & Families</h2>
            <form id="guest-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <input type="text" id="guest-name" placeholder="Guest's Name" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <input type="text" id="guest-family" placeholder="Family Name (e.g., Smith Family)" class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <button type="submit" class="col-span-1 md:col-span-2 bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200">Add Guest</button>
            </form>
            <!-- Edit form for guests (initially hidden) -->
            <form id="guest-edit-form" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-100 rounded-lg">
                <input type="hidden" id="guest-edit-id">
                <input type="text" id="guest-edit-name" placeholder="Guest's Name" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <input type="text" id="guest-edit-family" placeholder="Family Name" class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <div class="flex gap-2 col-span-1 md:col-span-2">
                    <button type="submit" class="flex-grow bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors duration-200">Update Guest</button>
                    <button type="button" onclick="window.hideEditForm('guest')" class="bg-gray-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors duration-200">Cancel</button>
                </div>
            </form>
            <ul id="guest-list" class="space-y-3"></ul>
        </section>

        <!-- Assignments Section -->
        <section id="assignments" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Assign Guests to Rooms</h2>
            <form id="assignment-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <select id="assignment-house" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select a House</option>
                </select>
                <select id="assignment-room" required disabled class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select a Room</option>
                </select>
                <select id="assignment-guest" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select a Guest</option>
                </select>
                <div class="col-span-1 md:col-span-2 lg:col-span-1">
                    <label for="assignment-start" class="block text-sm font-medium text-gray-700">Start Date:</label>
                    <input type="date" id="assignment-start" required class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 w-full">
                </div>
                <div class="col-span-1 md:col-span-2 lg:col-span-1">
                    <label for="assignment-end" class="block text-sm font-medium text-gray-700">End Date:</label>
                    <input type="date" id="assignment-end" required class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 w-full">
                </div>
                <button type="submit" class="col-span-1 md:col-span-2 lg:col-span-3 bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200">Assign</button>
            </form>
            <ul id="assignment-list" class="space-y-3"></ul>
        </section>

        <!-- Required Tasks Section -->
        <section id="tasks" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Required Tasks</h2>
            <div class="flex items-center gap-4 mb-4">
                <span class="font-medium">Sort by:</span>
                <button onclick="window.sortTasks('houseName')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-3 rounded-md transition-colors duration-200">House</button>
                <button onclick="window.sortTasks('name')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-3 rounded-md transition-colors duration-200">Room</button>
            </div>
            <ul id="tasks-list" class="space-y-3"></ul>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg transition-transform duration-300 transform hover:scale-105">
            <h2 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Reports</h2>
            <div class="flex gap-4 mb-6">
                <button onclick="window.showReportView('list-view')" class="report-tab active-tab bg-green-600 text-white font-medium py-2 px-4 rounded-md">List View</button>
                <button onclick="window.showReportView('calendar-view')" class="report-tab bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-md">Calendar View</button>
            </div>

            <!-- List View Report -->
            <div id="list-view" class="report-content active-report">
                <h3 class="text-xl font-semibold mb-4">All Assignments</h3>
                <ul id="reports-list" class="space-y-3"></ul>
            </div>

            <!-- Calendar View Report -->
            <div id="calendar-view" class="report-content hidden-report hidden">
                <h3 class="text-xl font-semibold mb-4">Assignments (Calendar View)</h3>
                <div id="calendar-controls" class="flex items-center justify-between mb-4 bg-gray-100 p-2 rounded-lg">
                    <button onclick="window.prevMonth()" class="bg-gray-300 text-gray-800 px-3 py-1 rounded-md">&lt; Prev</button>
                    <h4 id="current-month-year" class="text-lg font-semibold"></h4>
                    <button onclick="window.nextMonth()" class="bg-gray-300 text-gray-800 px-3 py-1 rounded-md">Next &gt;</button>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center text-sm"></div>
            </div>
        </section>

        <!-- Modal for Guest Assignment -->
        <div id="assignment-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
            <div class="relative p-8 bg-white w-96 rounded-lg shadow-lg">
                <button onclick="window.closeAssignmentModal()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-xl font-bold">&times;</button>
                <h3 class="text-2xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Assign Guest to Room</h3>
                <div id="modal-guest-info" class="mb-4"></div>
                <form id="modal-assignment-form" class="grid grid-cols-1 gap-4">
                    <select id="modal-assignment-house" required class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="" disabled selected>Select a House</option>
                    </select>
                    <select id="modal-assignment-room" required disabled class="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="" disabled selected>Select a Room</option>
                    </select>
                    <div>
                        <label for="modal-assignment-start" class="block text-sm font-medium text-gray-700">Start Date:</label>
                        <input type="date" id="modal-assignment-start" required class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 w-full">
                    </div>
                    <div>
                        <label for="modal-assignment-end" class="block text-sm font-medium text-gray-700">End Date:</label>
                        <input type="date" id="modal-assignment-end" required class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 w-full">
                    </div>
                    <button type="submit" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors duration-200 mt-4">Assign</button>
                </form>
            </div>
        </div>
    </main>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyB_0fHWf0Hrpjcv4Hn0QY4L4JDMpc9RFVc",
            authDomain: "home-guests.firebaseapp.com",
            projectId: "home-guests",
            storageBucket: "home-guests.firebasestorage.app",
            messagingSenderId: "527629164349",
            appId: "1:527629164349:web:6eca4e0ce1020d35f56f54"
        };
        const appId = "home-guests";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;

        // --- DOM Element References ---
        const sections = document.querySelectorAll('section');
        const houseForm = document.getElementById('house-form');
        const roomForm = document.getElementById('room-form');
        const guestForm = document.getElementById('guest-form');
        const assignmentForm = document.getElementById('assignment-form');
        const houseList = document.getElementById('house-list');
        const roomList = document.getElementById('room-list');
        const guestList = document.getElementById('guest-list');
        const assignmentList = document.getElementById('assignment-list');
        const reportsList = document.getElementById('reports-list');
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthYear = document.getElementById('current-month-year');
        const roomHouseSelect = document.getElementById('room-house');
        const assignmentHouseSelect = document.getElementById('assignment-house');
        const assignmentRoomSelect = document.getElementById('assignment-room');
        const assignmentGuestSelect = document.getElementById('assignment-guest');
        const dashboardTiles = document.getElementById('dashboard-tiles');
        const dashboardGuestsList = document.getElementById('dashboard-guests-list');
        const tasksList = document.getElementById('tasks-list');
        const userInfo = document.getElementById('user-info');
        const roomPrepItemInput = document.getElementById('room-prep-item');
        const prepListUl = document.getElementById('prep-list');
        const assignmentModal = document.getElementById('assignment-modal');
        const modalAssignmentForm = document.getElementById('modal-assignment-form');
        const modalAssignmentHouseSelect = document.getElementById('modal-assignment-house');
        const modalAssignmentRoomSelect = document.getElementById('modal-assignment-room');
        const modalAssignmentStartInput = document.getElementById('modal-assignment-start');
        const modalAssignmentEndInput = document.getElementById('modal-assignment-end');
        const modalGuestInfo = document.getElementById('modal-guest-info');

        // Edit form elements
        const houseEditForm = document.getElementById('house-edit-form');
        const houseEditId = document.getElementById('house-edit-id');
        const houseEditName = document.getElementById('house-edit-name');
        const roomEditForm = document.getElementById('room-edit-form');
        const roomEditId = document.getElementById('room-edit-id');
        const roomEditHouseId = document.getElementById('room-edit-houseId');
        const roomEditHouseName = document.getElementById('room-edit-houseName');
        const roomEditName = document.getElementById('room-edit-name');
        const roomEditCapacity = document.getElementById('room-edit-capacity');
        const roomEditBedType = document.getElementById('room-edit-bed-type');
        const roomEditPrepItemInput = document.getElementById('room-edit-prep-item');
        const editPrepListUl = document.getElementById('edit-prep-list');
        const guestEditForm = document.getElementById('guest-edit-form');
        const guestEditId = document.getElementById('guest-edit-id');
        const guestEditName = document.getElementById('guest-edit-name');
        const guestEditFamily = document.getElementById('guest-edit-family');


        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let tempPrepList = []; 
        let editTempPrepList = [];
        let roomsCache = [];
        let guestsCache = [];
        let assignmentsCache = [];
        let housesCache = [];

        // --- Firebase Auth & Initialization ---
        async function signIn() {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Error during authentication:", error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                userInfo.innerHTML = `<span class="text-sm">User ID: ${userId}</span>`;
                loadData();
            } else {
                console.log("User is signed out.");
                userId = null;
            }
        });

        // --- UI Functions ---
        window.showSection = function(sectionId) {
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            // Hide all edit forms when switching sections
            houseEditForm.classList.add('hidden');
            roomEditForm.classList.add('hidden');
            guestEditForm.classList.add('hidden');

            if (sectionId === 'reports') {
                renderReports();
                showReportView('list-view');
            }
            if (sectionId === 'dashboard') {
                renderDashboard();
            }
            if (sectionId === 'tasks') {
                renderTasks();
            }
        };

        window.showEditForm = function(formId, data) {
            // Hide all creation forms and show the edit form
            document.getElementById(formId).classList.remove('hidden');
            
            if (formId === 'house-edit-form') {
                houseForm.classList.add('hidden');
                houseEditId.value = data.id;
                houseEditName.value = data.name;
            } else if (formId === 'room-edit-form') {
                roomForm.classList.add('hidden');
                roomEditId.value = data.id;
                roomEditHouseId.value = data.houseId;
                roomEditHouseName.value = data.houseName;
                roomEditName.value = data.name;
                roomEditCapacity.value = data.capacity;
                roomEditBedType.value = data.bedType;
                editTempPrepList = data.prepNeeded || [];
                renderEditPrepList();
            } else if (formId === 'guest-edit-form') {
                guestForm.classList.add('hidden');
                guestEditId.value = data.id;
                guestEditName.value = data.name;
                guestEditFamily.value = data.family || '';
            }
        };

        window.hideEditForm = function(entity) {
            document.getElementById(`${entity}-edit-form`).classList.add('hidden');
            document.getElementById(`${entity}-form`).classList.remove('hidden');
        };

        window.showReportView = function(viewId) {
            document.querySelectorAll('.report-content').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');

            document.querySelectorAll('.report-tab').forEach(button => {
                button.classList.remove('bg-green-600', 'text-white');
                button.classList.add('bg-gray-200', 'text-gray-800');
            });
            document.querySelector(`button[onclick="window.showReportView('${viewId}')"]`).classList.add('bg-green-600', 'text-white');
            document.querySelector(`button[onclick="window.showReportView('${viewId}')"]`).classList.remove('bg-gray-200', 'text-gray-800');

            if (viewId === 'calendar-view') {
                renderCalendar();
            }
        };

        // --- Firestore CRUD Operations ---
        async function addData(collectionName, data) {
            if (!userId) {
                console.error("User not authenticated.");
                return;
            }
            try {
                const colRef = collection(db, `artifacts/${appId}/public/data/${collectionName}`);
                await addDoc(colRef, data);
                console.log(`Added data to ${collectionName}.`);
            } catch (error) {
                console.error(`Error adding data to ${collectionName}:`, error);
            }
        }

        async function updateData(collectionName, docId, data) {
            if (!userId) {
                console.error("User not authenticated.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/${collectionName}`, docId);
                await setDoc(docRef, data, { merge: true });
                console.log(`Updated data in ${collectionName}.`);
            } catch (error) {
                console.error(`Error updating data in ${collectionName}:`, error);
            }
        }

        async function deleteData(collectionName, docId) {
            if (!userId) {
                console.error("User not authenticated.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/${collectionName}`, docId);
                await deleteDoc(docRef);
                console.log(`Deleted data from ${collectionName}.`);
            } catch (error) {
                console.error(`Error deleting data from ${collectionName}:`, error);
            }
        }

        // --- Data Loading & Real-time Updates ---
        function loadData() {
            if (!userId) return;
            setupRealtimeListeners();
        }

        function setupRealtimeListeners() {
            onSnapshot(collection(db, `artifacts/${appId}/public/data/houses`), (snapshot) => {
                housesCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                houseList.innerHTML = '';
                housesCache.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500 flex justify-between items-center cursor-pointer';
                    li.onclick = () => window.showEditForm('house-edit-form', item);
                    li.innerHTML = `<span>üè° ${item.name}</span> <button class="bg-red-500 text-white text-sm py-1 px-3 rounded-md hover:bg-red-600 transition-colors duration-200" onclick="event.stopPropagation(); window.deleteDataWrapper('houses', '${item.id}')">Delete</button>`;
                    houseList.appendChild(li);
                });
                populateSelects();
            });

            onSnapshot(collection(db, `artifacts/${appId}/public/data/rooms`), (snapshot) => {
                roomsCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderRooms(roomsCache);
                populateSelects();
                renderTasks();
            });

            onSnapshot(collection(db, `artifacts/${appId}/public/data/guests`), (snapshot) => {
                guestList.innerHTML = '';
                guestsCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                guestsCache.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500 flex justify-between items-center cursor-pointer';
                    li.onclick = () => window.showEditForm('guest-edit-form', item);
                    li.innerHTML = `<span>üë§ ${item.name} ${item.family ? `(Family: ${item.family})` : ''}</span> <button class="bg-red-500 text-white text-sm py-1 px-3 rounded-md hover:bg-red-600 transition-colors duration-200" onclick="event.stopPropagation(); window.deleteDataWrapper('guests', '${item.id}')">Delete</button>`;
                    guestList.appendChild(li);
                });
                populateSelects();
            });

            onSnapshot(collection(db, `artifacts/${appId}/public/data/assignments`), (snapshot) => {
                assignmentsCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                assignmentList.innerHTML = '';
                assignmentsCache.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                assignmentsCache.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500 flex justify-between items-center';
                    li.innerHTML = `<span>üóìÔ∏è ${item.guestName} staying in ${item.roomName} at ${item.houseName} from ${item.startDate} to ${item.endDate}.</span> <button class="bg-red-500 text-white text-sm py-1 px-3 rounded-md hover:bg-red-600 transition-colors duration-200" onclick="window.deleteDataWrapper('assignments', '${item.id}')">Delete</button>`;
                    assignmentList.appendChild(li);
                });
                renderReports();
                renderCalendar();
                renderDashboard();
            });
        }
        
        window.deleteDataWrapper = function(collectionName, docId) {
            deleteData(collectionName, docId);
        };

        window.addPrepItem = function() {
            const item = roomPrepItemInput.value.trim();
            if (item) {
                tempPrepList.push(item);
                roomPrepItemInput.value = '';
                renderTempPrepList();
            }
        };

        window.removePrepItem = function(index) {
            tempPrepList.splice(index, 1);
            renderTempPrepList();
        };

        function renderTempPrepList() {
            prepListUl.innerHTML = '';
            tempPrepList.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-gray-200 p-2 rounded-md';
                li.innerHTML = `
                    <span>${item}</span>
                    <button type="button" onclick="window.removePrepItem(${index})" class="text-red-500 hover:text-red-700 font-bold ml-2 transition-colors duration-200">
                        &times;
                    </button>
                `;
                prepListUl.appendChild(li);
            });
        }

        window.addEditPrepItem = function() {
            const item = roomEditPrepItemInput.value.trim();
            if (item) {
                editTempPrepList.push(item);
                roomEditPrepItemInput.value = '';
                renderEditPrepList();
            }
        };

        window.removeEditPrepItem = function(index) {
            editTempPrepList.splice(index, 1);
            renderEditPrepList();
        };

        function renderEditPrepList() {
            editPrepListUl.innerHTML = '';
            editTempPrepList.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-gray-200 p-2 rounded-md';
                li.innerHTML = `
                    <span>${item}</span>
                    <button type="button" onclick="window.removeEditPrepItem(${index})" class="text-red-500 hover:text-red-700 font-bold ml-2 transition-colors duration-200">
                        &times;
                    </button>
                `;
                editPrepListUl.appendChild(li);
            });
        }
        
        async function populateSelects() {
            if (!userId) return;

            roomHouseSelect.innerHTML = '<option value="" disabled selected>Select a House</option>';
            assignmentHouseSelect.innerHTML = '<option value="" disabled selected>Select a House</option>';
            assignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';
            assignmentGuestSelect.innerHTML = '<option value="" disabled selected>Select a Guest</option>';
            assignmentRoomSelect.disabled = true;

            modalAssignmentHouseSelect.innerHTML = '<option value="" disabled selected>Select a House</option>';
            modalAssignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';
            modalAssignmentRoomSelect.disabled = true;

            try {
                housesCache.forEach(house => {
                    const option1 = new Option(house.name, house.id);
                    const option2 = new Option(house.name, house.id);
                    const option3 = new Option(house.name, house.id);
                    roomHouseSelect.add(option1);
                    assignmentHouseSelect.add(option2);
                    modalAssignmentHouseSelect.add(option3);
                });

                const uniqueFamilies = [...new Set(guestsCache.filter(g => g.family).map(g => g.family))];
                uniqueFamilies.forEach(family => {
                    const familyOption = new Option(`Family: ${family}`, `family-${family}`);
                    assignmentGuestSelect.add(familyOption);
                });
                guestsCache.forEach(guest => {
                    const guestOption = new Option(guest.name, guest.id);
                    assignmentGuestSelect.add(guestOption);
                });

            } catch (error) {
                console.error("Error populating selects:", error);
            }
        }

        houseForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('house-name').value;
            addData('houses', { name });
            e.target.reset();
        });

        houseEditForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = houseEditId.value;
            const name = houseEditName.value;
            updateData('houses', id, { name });
            window.hideEditForm('house');
        });

        roomForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const houseId = document.getElementById('room-house').value;
            const name = document.getElementById('room-name').value;
            const capacity = parseInt(document.getElementById('room-capacity').value);
            const bedType = document.getElementById('room-bed-type').value;
            const house = housesCache.find(h => h.id === houseId);
            
            if (house) {
                addData('rooms', { houseId, houseName: house.name, name, capacity, bedType, prepNeeded: tempPrepList });
                e.target.reset();
                tempPrepList = []; 
                renderTempPrepList();
                document.getElementById('room-house').value = "";
            } else {
                console.error("House not found for the selected ID.");
            }
        });

        roomEditForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = roomEditId.value;
            const houseId = roomEditHouseId.value;
            const houseName = roomEditHouseName.value;
            const name = roomEditName.value;
            const capacity = parseInt(roomEditCapacity.value);
            const bedType = roomEditBedType.value;
            updateData('rooms', id, { houseId, houseName, name, capacity, bedType, prepNeeded: editTempPrepList });
            window.hideEditForm('room');
        });

        guestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('guest-name').value;
            const family = document.getElementById('guest-family').value;
            addData('guests', { name, family });
            e.target.reset();
        });

        guestEditForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = guestEditId.value;
            const name = guestEditName.value;
            const family = guestEditFamily.value;
            updateData('guests', id, { name, family });
            window.hideEditForm('guest');
        });

        assignmentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const houseId = document.getElementById('assignment-house').value;
            const roomId = document.getElementById('assignment-room').value;
            const guestIdentifier = document.getElementById('assignment-guest').value;
            const startDate = document.getElementById('assignment-start').value;
            const endDate = document.getElementById('assignment-end').value;

            try {
                const room = roomsCache.find(r => r.id === roomId);

                if (guestIdentifier.startsWith('family-')) {
                    const familyName = guestIdentifier.replace('family-', '');
                    const familyMembers = guestsCache.filter(g => g.family === familyName);
                    for (const guest of familyMembers) {
                         addData('assignments', { houseId, houseName: room.houseName, roomId, roomName: room.name, guestId: guest.id, guestName: guest.name, startDate, endDate });
                    }
                } else {
                    const guest = guestsCache.find(g => g.id === guestIdentifier);
                    addData('assignments', { houseId, houseName: room.houseName, roomId, roomName: room.name, guestId: guest.id, guestName: guest.name, startDate, endDate });
                }
                
                e.target.reset();
                assignmentRoomSelect.disabled = true;
                assignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';
            } catch (error) {
                console.error("Error adding assignment:", error);
            }
        });
        
        modalAssignmentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const guestId = modalAssignmentForm.dataset.guestId;
            const houseId = modalAssignmentHouseSelect.value;
            const roomId = modalAssignmentRoomSelect.value;
            const startDate = modalAssignmentStartInput.value;
            const endDate = modalAssignmentEndInput.value;

            try {
                const room = roomsCache.find(r => r.id === roomId);
                const guest = guestsCache.find(g => g.id === guestId);
                
                if (room && guest) {
                    addData('assignments', { houseId, houseName: room.houseName, roomId, roomName: room.name, guestId: guest.id, guestName: guest.name, startDate, endDate });
                    window.closeAssignmentModal();
                }
            } catch (error) {
                console.error("Error adding assignment from modal:", error);
            }
        });


        assignmentHouseSelect.addEventListener('change', async (e) => {
            const houseId = e.target.value;
            assignmentRoomSelect.disabled = false;
            assignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';

            const filteredRooms = roomsCache.filter(room => room.houseId === houseId);
            filteredRooms.forEach(room => {
                const option = new Option(room.name, room.id);
                assignmentRoomSelect.add(option);
            });
        });
        
        modalAssignmentHouseSelect.addEventListener('change', (e) => {
            const houseId = e.target.value;
            modalAssignmentRoomSelect.disabled = false;
            modalAssignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';
            
            const filteredRooms = roomsCache.filter(room => room.houseId === houseId);
            filteredRooms.forEach(room => {
                const option = new Option(room.name, room.id);
                modalAssignmentRoomSelect.add(option);
            });
        });
        
        let currentRoomsData = [];
        let allTasksData = [];

        function renderRooms(roomsData) {
            currentRoomsData = roomsData;
            sortRooms('houseName'); 
        }

        window.sortRooms = function(sortBy) {
            roomList.innerHTML = '';
            
            let sortedData = [...currentRoomsData];

            if (sortBy === 'houseName') {
                sortedData.sort((a, b) => a.houseName.localeCompare(b.houseName) || a.name.localeCompare(b.name));
            } else if (sortBy === 'name') {
                sortedData.sort((a, b) => a.name.localeCompare(b.name) || a.houseName.localeCompare(b.houseName));
            }
            
            sortedData.forEach(item => {
                const li = document.createElement('li');
                li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500 flex justify-between items-center cursor-pointer';
                li.onclick = () => window.showEditForm('room-edit-form', item);
                let prepListHtml = '';
                if (item.prepNeeded && item.prepNeeded.length > 0) {
                    prepListHtml = `
                        <br><strong class="font-semibold text-gray-700">Prep Needed:</strong>
                        <ul class="list-disc list-inside mt-1 ml-4 text-sm">${item.prepNeeded.map(prep => `<li>${prep}</li>`).join('')}</ul>
                    `;
                }
                li.innerHTML = `
                    <div class="w-full">
                        <div class="flex items-center justify-between">
                            <span>
                                üö™ <strong class="text-lg">${item.name}</strong> (${item.houseName})
                            </span>
                            <button class="bg-red-500 text-white text-sm py-1 px-3 rounded-md hover:bg-red-600 transition-colors duration-200" onclick="event.stopPropagation(); window.deleteDataWrapper('rooms', '${item.id}')">Delete</button>
                        </div>
                        <p class="text-sm mt-2 text-gray-600">Capacity: ${item.capacity}, Bed: ${item.bedType}</p>
                        ${prepListHtml}
                    </div>
                `;
                roomList.appendChild(li);
            });
        };

        function renderTasks() {
            tasksList.innerHTML = '';
            allTasksData = [];
            roomsCache.forEach(room => {
                if (room.prepNeeded && room.prepNeeded.length > 0) {
                    room.prepNeeded.forEach(task => {
                        allTasksData.push({
                            houseName: room.houseName,
                            roomName: room.name,
                            task: task
                        });
                    });
                }
            });
            sortTasks('houseName');
        }

        window.sortTasks = function(sortBy) {
            tasksList.innerHTML = '';
            let sortedTasks = [...allTasksData];

            if (sortBy === 'houseName') {
                sortedTasks.sort((a, b) => a.houseName.localeCompare(b.houseName) || a.roomName.localeCompare(b.roomName));
            } else if (sortBy === 'name') {
                sortedTasks.sort((a, b) => a.roomName.localeCompare(b.roomName) || a.houseName.localeCompare(b.houseName));
            }

            sortedTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500';
                li.innerHTML = `
                    <p class="text-gray-800">
                        <strong class="font-semibold">${task.houseName}</strong> - ${task.roomName}: ${task.task}
                    </p>
                `;
                tasksList.appendChild(li);
            });
        }


        async function renderDashboard() {
            if (!userId) return;
            const today = new Date().toISOString().split('T')[0];
            dashboardTiles.innerHTML = ''; 
            dashboardGuestsList.innerHTML = ''; 

            try {
                const houses = housesCache;
                const rooms = roomsCache;
                const assignments = assignmentsCache;
                const guests = guestsCache;

                houses.forEach(house => {
                    const houseTile = document.createElement('div');
                    houseTile.className = 'bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500';
                    houseTile.innerHTML = `<h3 class="text-xl font-bold text-green-700 mb-4">üè° ${house.name}</h3><div class="space-y-4"></div>`;
                    const roomGrid = houseTile.querySelector('div');

                    const houseRooms = rooms.filter(room => room.houseId === house.id);

                    houseRooms.forEach(room => {
                        const roomTile = document.createElement('div');
                        
                        const activeAssignment = assignments.find(a => 
                            a.roomId === room.id && a.startDate <= today && a.endDate >= today
                        );
                        
                        let statusHtml = '';
                        if (activeAssignment) {
                            roomTile.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-red-500';
                            statusHtml = `<p class="font-semibold text-red-700">Status: <span class="font-bold text-gray-800">Unavailable</span></p>`;
                        } else {
                            roomTile.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500';
                            statusHtml = `<p class="font-semibold text-green-700">Status: <span class="font-bold text-gray-800">Available</span></p>`;
                            statusHtml += `<p class="text-sm text-gray-600">Capacity: ${room.capacity}, Bed: ${room.bedType}</p>`;
                        }

                        roomTile.innerHTML = `
                            <h4 class="font-bold text-lg mb-1">${room.name}</h4>
                            ${statusHtml}
                        `;
                        roomGrid.appendChild(roomTile);
                    });

                    dashboardTiles.appendChild(houseTile);
                });

                const guestListContainer = document.createElement('div');
                guestListContainer.innerHTML = '<h3 class="text-xl font-bold text-green-600 border-b-2 border-gray-200 pb-2 mb-4">Guest Status</h3><ul class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></ul>';
                const guestUl = guestListContainer.querySelector('ul');
                guests.forEach(guest => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-50 p-4 rounded-lg shadow flex justify-between items-center cursor-pointer hover:bg-gray-100 transition-colors duration-200';
                    li.setAttribute('data-guest-id', guest.id);
                    li.setAttribute('data-guest-name', guest.name);
                    li.onclick = () => window.openAssignmentModal(guest.id, guest.name);

                    const isAssigned = assignments.some(a => a.guestId === guest.id && a.startDate <= today && a.endDate >= today);
                    
                    const statusClass = isAssigned ? 'bg-green-500' : 'bg-red-500';
                    const statusText = isAssigned ? 'Assigned' : 'Not Assigned';
                    
                    li.innerHTML = `
                        <span class="font-medium text-gray-800">${guest.name}</span>
                        <span class="py-1 px-3 text-white text-xs font-bold rounded-full ${statusClass}">${statusText}</span>
                    `;
                    guestUl.appendChild(li);
                });
                dashboardGuestsList.appendChild(guestListContainer);

            } catch (error) {
                console.error("Error rendering dashboard:", error);
            }
        }

        window.openAssignmentModal = function(guestId, guestName) {
            modalGuestInfo.innerHTML = `<p class="text-lg font-semibold">Assigning: ${guestName}</p>`;
            modalAssignmentForm.setAttribute('data-guest-id', guestId);
            assignmentModal.classList.remove('hidden');
        };

        window.closeAssignmentModal = function() {
            assignmentModal.classList.add('hidden');
            modalAssignmentForm.reset();
            modalAssignmentRoomSelect.innerHTML = '<option value="" disabled selected>Select a Room</option>';
            modalAssignmentRoomSelect.disabled = true;
        };

        async function renderReports() {
            if (!userId) return;
            reportsList.innerHTML = '';
            try {
                const assignmentsSnap = await getDocs(collection(db, `artifacts/${appId}/public/data/assignments`));
                const assignments = assignmentsSnap.docs.map(doc => doc.data());
                assignments.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                assignments.forEach(assignment => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-50 p-4 rounded-lg shadow border-l-4 border-green-500';
                    li.innerHTML = `<strong class="font-semibold text-gray-800">${assignment.guestName}</strong> is staying in <strong class="text-gray-800">${assignment.roomName}</strong> at <strong class="text-gray-800">${assignment.houseName}</strong> from ${assignment.startDate} to ${assignment.endDate}.`;
                    reportsList.appendChild(li);
                });
            } catch (error) {
                console.error("Error rendering reports:", error);
            }
        }

        async function renderCalendar() {
            if (!userId) return;
            calendarGrid.innerHTML = '';
            currentMonthYear.textContent = `${new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long' })} ${currentYear}`;

            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            daysOfWeek.forEach(day => {
                const header = document.createElement('div');
                header.className = 'font-bold text-gray-600 p-2';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'p-2 bg-gray-200 rounded-md';
                calendarGrid.appendChild(dayDiv);
            }

            try {
                const assignments = assignmentsCache;
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'p-2 border border-gray-300 rounded-md bg-white min-h-[100px] flex flex-col items-start';
                    if (new Date(currentYear, currentMonth, i).toISOString().split('T')[0] === todayStr) {
                        dayDiv.classList.add('bg-green-100', 'border-green-500');
                    }
                    
                    const dayNum = document.createElement('h5');
                    dayNum.textContent = i;
                    dayNum.className = 'font-bold text-lg mb-1';
                    dayDiv.appendChild(dayNum);

                    const currentDate = new Date(currentYear, currentMonth, i).toISOString().split('T')[0];

                    assignments.forEach(assignment => {
                        if (currentDate >= assignment.startDate && currentDate <= assignment.endDate) {
                            const assignmentItem = document.createElement('div');
                            assignmentItem.className = 'text-xs text-gray-800 bg-green-200 px-2 py-1 rounded-full mb-1 overflow-hidden whitespace-nowrap text-ellipsis w-full';
                            assignmentItem.textContent = `${assignment.guestName}`;
                            dayDiv.appendChild(assignmentItem);
                        }
                    });
                    calendarGrid.appendChild(dayDiv);
                }
            } catch (error) {
                console.error("Error rendering calendar:", error);
            }
        }

        window.prevMonth = function() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        };

        window.nextMonth = function() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        };

        window.onload = signIn;
    </script>
</body>
</html>
